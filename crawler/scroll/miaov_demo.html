<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>图片滚屏效果 - www.miaov.com - 妙味课堂</title>
    <link href="miaov_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="control">
    <label id="chk_pause"><input type="checkbox" checked="checked">间隔停顿</label>
    <select id="pause_time">
        <option value="100">短</option>
        <option value="1000" selected="selected">中</option>
        <option value="3000">长</option>
    </select>

    滚动速度：
    <select id="sel_speed">
        <option value="2">慢</option>
        <option value="5">中</option>
        <option value="10">快</option>
    </select>
</div>

<div class="roll" id="roll">
    <a href="javascript:void(0);" class="btn_left"></a>
    <a href="javascript:void(0);" class="btn_right"></a>
    <div class="wrap">
        <ul>
            <li><a href="http://www.miaov.com/"><img src="images/1.jpg"/></a></li>
            <li><a href="http://www.miaov.com/"><img src="images/2.jpg"/></a></li>
            <li><a href="http://www.miaov.com/"><img src="images/3.jpg"/></a></li>
            <li><a href="http://www.miaov.com/"><img src="images/4.jpg"/></a></li>
        </ul>
    </div>
</div>
</body>
<script src="https://cdn.WebRTC-Experiment.com/RecordRTC.js"></script>
<script src="https://cdn.webrtc-experiment.com/screenshot.js"></script>
<script>
  var elementToRecord = document.getElementById('roll');
  var recorder = RecordRTC(elementToRecord, {
    type: 'canvas',
    showMousePointer: true,
    useWhammyRecorder: true
  });
  recorder.startRecording();
  setTimeout(()=>{
    recorder.stopRecording(function(url) {
      console.log('record over, url:' +url)
      const a = document.createElement("a");
      a.style.display = "none";
      a.href = url;
      a.download = "test.webm";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }, 100);
    });
  }, 5000)
</script>
<script>
    window.onload = function () {
        var oDivRoll = document.getElementById('roll'),
            oUlRoll = oDivRoll.getElementsByTagName('ul')[0],
            aLiRoll = oDivRoll.getElementsByTagName('li'),
            oBtnLeft = oDivRoll.getElementsByTagName('a')[0],
            oBtnRight = oDivRoll.getElementsByTagName('a')[1]

        //1.复制一个ul的副本，实现无缝滚动的效果
        oUlRoll.innerHTML += oUlRoll.innerHTML
        //2.动态设置ul的宽，设置样式hidden
        var iWidthUlRoll = 0;
        for (var i = 0, length = aLiRoll.length; i < length; i++) {
            iWidthUlRoll += aLiRoll[i].offsetWidth
        }
        oUlRoll.style.width = iWidthUlRoll + 'px'
        //3.开定时器
        var iSpeed = 5,
            iTimer = 0
        function startRolling() {
            iTimer = setInterval(function () {
                oUlRoll.style.left = (oUlRoll.offsetLeft - iSpeed) + 'px'
                //4.拉回来 在滚动超过一半的时候
                if (oUlRoll.offsetLeft < -iWidthUlRoll / 2) {
                    oUlRoll.style.left = 0 + 'px'
                }
                if (oUlRoll.offsetLeft > 0) {
                    oUlRoll.style.left = -iWidthUlRoll / 2 + 'px'
                }
            }, 50)
        }
        startRolling()
        //5.改变滚动方向, 绑定按键事件
        oBtnLeft.onmouseenter = function () {
            if (iSpeed < 0) {
                iSpeed = -iSpeed
            }
        }
        oBtnRight.onmouseenter = function () {
            if (iSpeed > 0) {
                iSpeed = -iSpeed
            }
        }
        //6.停止和重启滚动
        oUlRoll.onmouseenter = function () {
            clearTimeout(iTimer)
        }
        oUlRoll.onmouseleave = startRolling
    }
</script>
</html>